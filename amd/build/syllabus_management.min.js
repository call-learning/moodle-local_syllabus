/**
 * A javascript module to retrieve a course list from the server.
 *
 * @copyright  2020 CALL Learning 2020 - Laurent David laurent@call-learning.fr
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_syllabus/syllabus_management",["jquery","core/ajax","core/str","core/notification","core/sortable_list"],(function($,Ajax,Str,Notification,SortableList){return{init:function(){var sortwloc=new SortableList($("#syllabus-management .location-list tbody"),{moveHandlerSelector:".movefield [data-drag-type=move]"});sortwloc.getDestinationName=function(parentElement,afterElement){return afterElement.length?afterElement.attr("data-field-name")?Str.get_string("afterfield","local_syllabus",afterElement.attr("data-field-name")):$.Deferred().resolve(""):Str.get_string("totopoflocation","local_syllabus",parentElement.closest("[data-location-id]").attr("data-label"))},$("[data-field-name]").on("sortablelist-drop",(function(evt,info){!function(evt,info){if(evt.stopPropagation(),info.positionChanged){const fieldid=info.element.data("field-id"),location=info.targetList.closest("[data-location-id]").attr("data-location-id");var beforeid=info.targetNextElement.data("field-id");Ajax.call([{methodname:"local_syllabus_move_field_to_location",args:{fieldid:fieldid,location:location,beforeid:beforeid}}])[0].fail(Notification.exception)}}(evt,info)})).on("sortablelist-drag",(function(evt){!function(evt){evt.stopPropagation(),Str.get_string("therearenofields","core_customfield").then((function(s){return $("#syllabus-management .location-list").children().each((function(){var fields=$(this).find($(".field")),nofields=$(this).find($(".nofields"));fields.length||nofields.length||$(this).find("tbody").append('<tr class="nofields"><td colspan="5">'+s+"</td></tr>"),fields.length&&nofields.length&&nofields.remove()})),null})).fail(Notification.exception)}(evt)})),$("[data-field-name]").on("sortablelist-dragstart",(function(evt,info){setTimeout((function(){$(".sortable-list-is-dragged").width(info.element.width())}),501)})),$("[data-role=removefield]").on("click",(function(e){const fieldid=$(this).attr("data-id");Ajax.call([{methodname:"local_syllabus_move_field_to_location",args:{fieldid:fieldid,location:"none",beforeid:0}}])[0].then((function(){return window.location.reload(),""})).fail(Notification.exception),e.preventDefault()}))}}}));

//# sourceMappingURL=syllabus_management.min.js.map